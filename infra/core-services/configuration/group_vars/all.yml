---
# Core Services Configuration

# User configuration
core_services_user: dmg
core_services_user_home: "/home/{{ core_services_user }}"

# Network configuration
core_services_ip: "10.0.70.70"
core_services_allowed_subnets:
  - "10.0.70.0/24"  # VM subnet
  - "10.0.60.0/24"  # Mac/client subnet
core_services_http_port: 80
core_services_https_port: 443

# Plane configuration
plane_internal_port: 3001
plane_docker_dir: "{{ core_services_user_home }}/plane"
plane_app_release: "v1.2.1"

# Rewind configuration
# Internal ports (Docker containers bind to localhost on these)
rewind_api_port: 8429
rewind_web_port: 8430
# External ports (Caddy listens on these with TLS)
rewind_api_external_port: 8443
rewind_web_external_port: 8444
rewind_enabled: true
rewind_docker_dir: "{{ core_services_user_home }}/rewind"

# Neo4j connection (external VM)
neo4j_ip: "{{ lookup('env', 'NEO4J_IP') | default('10.0.70.60', true) }}"
neo4j_bolt_port: 7687
neo4j_password: "{{ lookup('env', 'NEO4J_PASSWORD') | default('changeme', true) }}"

# Sysctl settings - enable IP forwarding for Docker
sysctl_overwrite:
  net.ipv4.ip_forward: 1
  net.ipv6.conf.all.forwarding: 1

# Docker configuration (geerlingguy.docker role)
docker_users:
  - "{{ core_services_user }}"
docker_install_compose_plugin: true
docker_compose_package: docker-compose-plugin
docker_compose_package_state: present

# Plane secrets (from environment variables for security)
# Generate with: openssl rand -hex 32
plane_secret_key: "{{ lookup('env', 'PLANE_SECRET_KEY') | default('changeme-generate-with-openssl-rand-hex-32', true) }}"
# Generate with: openssl rand -hex 16
plane_live_secret_key: "{{ lookup('env', 'PLANE_LIVE_SECRET_KEY') | default('changeme-generate-with-openssl-rand-hex-16', true) }}"
# Generate with: openssl rand -base64 24
plane_postgres_password: "{{ lookup('env', 'PLANE_POSTGRES_PASSWORD') | default('changeme', true) }}"
# Generate with: openssl rand -base64 24
plane_rabbitmq_password: "{{ lookup('env', 'PLANE_RABBITMQ_PASSWORD') | default('changeme', true) }}"

# MinIO/S3 credentials
plane_minio_access_key: "{{ lookup('env', 'PLANE_MINIO_ACCESS_KEY') | default('access-key', true) }}"
plane_minio_secret_key: "{{ lookup('env', 'PLANE_MINIO_SECRET_KEY') | default('secret-key', true) }}"

# Caddy configuration
caddy_email: "{{ lookup('env', 'CADDY_EMAIL') | default('admin@core-services.local', true) }}"
