---
# OS Hardening Configuration (devsec.hardening.os_hardening)

# Sysctl settings - enable IP forwarding for Docker
sysctl_overwrite:
  net.ipv4.ip_forward: 1
  net.ipv6.conf.all.forwarding: 1

# Allow specific kernel modules needed for Docker/containers
os_hardening_allowed_kernel_modules:
  - overlay
  - br_netfilter

# Users allowed to use cron
os_hardening_allowed_cron_users:
  - root
  - "{{ dev_user }}"

# Don't disable kernel module loading (needed for Docker)
os_security_kernel_module_loading: true

# Password policy - relaxed for dev environment
os_auth_pw_max_age: 99999
os_auth_pw_min_age: 0

# SSH Hardening Configuration (devsec.hardening.ssh_hardening)

# SSH authentication
ssh_permit_root_login: "no"
ssh_allow_users: "{{ dev_user }}"
ssh_allow_agent_forwarding: true
ssh_allow_tcp_forwarding: true

# Key-based auth only
ssh_server_password_login: false
ssh_challengeresponseauthentication: false

# Modern crypto settings for Ubuntu 24.04 / OpenSSH 9.x
# Note: role uses ssh_kex, NOT ssh_kex_algorithms
ssh_kex:
  - sntrup761x25519-sha512@openssh.com
  - curve25519-sha256
  - curve25519-sha256@libssh.org
  - diffie-hellman-group18-sha512
  - diffie-hellman-group16-sha512

ssh_ciphers:
  - chacha20-poly1305@openssh.com
  - aes256-gcm@openssh.com
  - aes128-gcm@openssh.com
  - aes256-ctr
  - aes192-ctr
  - aes128-ctr

ssh_macs:
  - hmac-sha2-512-etm@openssh.com
  - hmac-sha2-256-etm@openssh.com
  - umac-128-etm@openssh.com

# Host key algorithms for Ubuntu 24.04
ssh_host_key_algorithms:
  - ssh-ed25519
  - rsa-sha2-512
  - rsa-sha2-256

# Client alive settings
ssh_client_alive_interval: 300
ssh_client_alive_count: 3

# Ubuntu 24.04 / OpenSSH 9.x compatibility settings
ssh_use_pam: true                          # Required for proper auth on Ubuntu
sftp_enabled: true                         # Enable SFTP (Ansible uses it by default)
ssh_print_pam_motd: false                  # Disable duplicate MOTD
ssh_print_last_log: true                   # Show last login info

# Don't regenerate host keys (can cause issues on Ubuntu 24.04)
ssh_server_hardening: true
sshd_moduli_minimum: 3072

# Development Environment Settings

# User for development (can be overridden via -e cloud_init_user=xxx)
dev_user: "{{ cloud_init_user | default('dmg') }}"
dev_user_home: "/home/{{ dev_user }}"

# Git configuration
git_user_email: "me@davidgaribay.dev"
git_user_name: "David Garibay"

# GitHub CLI token (optional - set via environment variable for security)
# export ANSIBLE_GH_TOKEN="ghp_xxxx" then pass with -e "gh_token=$ANSIBLE_GH_TOKEN"
gh_token: ""

# NVM version
nvm_version: "v0.40.3"

# tea CLI version (Gitea CLI) - optional, disabled by default
# Enable with: -e "install_gitea_tea=true"
install_gitea_tea: false
tea_version: "0.11.1"

# Packages to install
dev_packages:
  - git
  - curl
  - wget
  - vim
  - htop
  - tmux
  - jq
  - unzip
  - ca-certificates
  - gnupg
  - lsb-release
  - apt-transport-https
  - software-properties-common
  - build-essential
  - bubblewrap  # Required for Claude Code sandbox mode on Linux

# Docker configuration (geerlingguy.docker role)
docker_users:
  - "{{ dev_user }}"
docker_install_compose_plugin: true
docker_compose_package: docker-compose-plugin
docker_compose_package_state: present

# Neo4j MCP Configuration
# neo4j_ip is passed from the orchestration script via -e flag
neo4j_ip: "{{ lookup('env', 'NEO4J_IP') | default('10.0.70.50', true) }}"
neo4j_uri: "bolt://{{ neo4j_ip }}:7687"
neo4j_username: "neo4j"
neo4j_password: "{{ lookup('env', 'NEO4J_PASSWORD') | default('changeme', true) }}"

# Plane MCP Configuration
# plane_ip is passed from the orchestration script via -e flag
plane_ip: "{{ lookup('env', 'PLANE_IP') | default('10.0.70.70', true) }}"
plane_api_url: "https://{{ plane_ip }}"
plane_workspace_slug: "{{ lookup('env', 'PLANE_WORKSPACE_SLUG') | default('', true) }}"
plane_api_key: "{{ lookup('env', 'PLANE_API_KEY') | default('', true) }}"
