---
# Neo4j Docker Compose Configuration
# Managed by Ansible - DO NOT EDIT MANUALLY

services:
  neo4j:
    image: {{ neo4j_docker_image }}
    container_name: {{ neo4j_container_name }}
    restart: unless-stopped
    ports:
      - "{{ neo4j_bolt_port }}:7687"
      - "{{ neo4j_http_port }}:7474"
    environment:
      # Authentication: neo4j/<password>
      NEO4J_AUTH: "neo4j/{{ neo4j_admin_password }}"
      # Server configuration
      NEO4J_server_default__listen__address: "0.0.0.0"
      NEO4J_server_bolt_advertised__address: "{{ neo4j_ip }}:{{ neo4j_bolt_port }}"
      NEO4J_server_http_advertised__address: "{{ neo4j_ip }}:{{ neo4j_http_port }}"
      # Memory configuration
      NEO4J_server_memory_heap_initial__size: "{{ neo4j_server_memory_heap_initial_size }}"
      NEO4J_server_memory_heap_max__size: "{{ neo4j_server_memory_heap_max_size }}"
      NEO4J_server_memory_pagecache_size: "{{ neo4j_server_memory_pagecache_size }}"
      # Disable telemetry
      NEO4J_dbms_usage__report_enabled: "false"
    volumes:
      - {{ neo4j_data_volume }}:/data
      - {{ neo4j_logs_volume }}:/logs
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:7474"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

volumes:
  {{ neo4j_data_volume }}:
    driver: local
  {{ neo4j_logs_volume }}:
    driver: local
